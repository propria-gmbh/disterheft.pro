# План имплементации приложения для генерации листингов Shopify

Этот документ хранится в репозитории и является живым планом.
Изменения фиксируются в разделе "Журнал изменений".

## 1. Контекст и цель
Цель: автоматизировать создание листинга Shopify на базе исходных данных
продукта конкурента, с генерацией изображений, контента, классификации
и публикацией через GraphQL API.

## 2. Текущий статус

### 2.1 Реализовано
- Генерация фронтального изображения и 3/4 на основании:
  - референс фото продукта
  - референс фото модели (женщина и мужчина)
- Генерация фронтального изображения продукта и 3/4 без модели:
  - только на основании референс фото продукта

### 2.2 В работе
- Генерация фронтального изображения на основании:
  - сгенерированного фронт изображения
  - референс фото продукта другого цвета

## 3. Планируемая функциональность
- Генерация заголовка, описания и хендлера:
  - на основании данных продукта конкурента
  - соблюдение требований GMC
  - заголовок должен содержать релевантные keywords
- Перевод и локализация описаний при необходимости:
  - адаптация под рынок конкретного магазина
- Обновление цены и цены до скидки (compare-at price)
- Замена исходных изображений в продукте на сгенерированные
- Трансформация сгенерированных изображений в формат WebP
- Выбор и установка категории по Shopify-классификации
- Загрузка продукта в магазин через GraphQL API

## 4. Предлагаемая структура решения

### 4.1 Модули
1) Ingestion и нормализация данных конкурента
2) Генерация изображений
3) Генерация текстового контента
4) Валидация по GMC и правилам магазина
5) Классификация по Shopify taxonomy
6) Публикация через Shopify GraphQL API
7) Логи, аудит, обратная связь

### 4.2 Поток данных (end-to-end)
1) Ввод: URL/ID товара конкурента + референс изображения
2) Извлечение атрибутов (название, параметры, материалы, цвет, размеры)
3) Нормализация атрибутов и формирование канонической модели продукта
4) Генерация изображений (front, 3/4, варианты цвета)
5) Генерация заголовка, описания, хендлера
6) Валидация: GMC, формат Shopify, контентные ограничения
7) Классификация: Shopify taxonomy
8) Подготовка медиа и product payload
9) Публикация в магазин через GraphQL API
10) Пост-проверка и логирование результата (draft + published)

## 5. Этапы реализации

### Этап 1. Модель данных и ingestion
- Схема продукта (обязательные поля)
- Маппинг атрибутов конкурента -> внутренний формат
- Очистка, нормализация, детект недостающих полей
- Спецификация форматов изображений

### Этап 2. Генерация изображений и пайплайн ассетов
- Очередь задач и статусы
- Хранилище сгенерированных изображений
- Стандарты размеров, форматов, качества
- Конвертация изображений в WebP для публикации
- Сопоставление изображений с вариантами товара

### Этап 3. Генерация текста и правила качества
- Шаблоны и промпты
- Контроль длины и структуры
- Проверки на соответствие GMC
- Генерация SEO keywords и проверка на дубликаты
- Перевод и адаптация текста под рынок магазина

### Этап 4. Shopify taxonomy и публикация
- Маппинг категорий к Shopify taxonomy
- Валидация через справочники/правила
- Сборка payload для GraphQL API
- Обработка ошибок и повторные попытки
- Обновление цены и цены до скидки на уровне variant

### Этап 5. QA, мониторинг, обратная связь
- Визуальная проверка изображений
- Логирование успешных и неуспешных публикаций
- Метрики качества и воронки
- Внесение правок по результатам тестов
- Проверка статуса после загрузки:
  - сверка draft-версии (если используется)
  - подтверждение опубликованного состояния

## 6. Требования качества и соответствия GMC
- Заголовок и описание должны:
  - не содержать запрещенных формулировок
  - отражать основные атрибуты товара
  - соответствовать требованиям длины и структуры
- Локализация должна учитывать:
  - язык, валюту, единицы измерения и культурный контекст рынка
  - правила валют:
    - точность и формат (разделители, символ валюты)
    - округление и минимальные пороги
  - правила размерных сеток:
    - маппинг между системами (EU/US/UK)
    - единицы измерения (см/дюймы)
  - культурные ограничения:
    - запрещенные термины, символика, чувствительные темы
  - локальные ключевые слова:
    - региональные синонимы и поисковые паттерны
- Изображения должны:
  - быть релевантными товару
  - иметь достаточное качество и единый стиль

## 7. Риски и зависимости
- Полнота данных конкурента может быть недостаточной
- Вариативность качества референс изображений
- Ошибки классификации Shopify taxonomy
- Изменения требований GMC и Shopify

## 8. Открытые вопросы
- Источники и формат входных данных конкурента
- Минимальный набор атрибутов для публикации
- Приоритеты по типам товаров
- Требуемые языки локализации (RU/EN/DE)

## 9. Журнал изменений
- 2026-02-08: Создан базовый план
- 2026-02-08: Добавлена конвертация изображений в WebP
- 2026-02-08: Добавлены перевод и адаптация под рынок
- 2026-02-08: Добавлены цены и правила локализации
- 2026-02-08: Добавлена проверка draft/published после загрузки
